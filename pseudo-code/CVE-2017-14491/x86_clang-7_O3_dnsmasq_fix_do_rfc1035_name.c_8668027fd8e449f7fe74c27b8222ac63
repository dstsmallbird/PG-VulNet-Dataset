_BYTE *__cdecl do_rfc1035_name(_BYTE *a1, char *a2, unsigned int a3)
{
  char *v3; // ecx
  _BYTE *v4; // edi
  char v5; // dl
  _BYTE *result; // eax
  int v7; // ebx
  char *v8; // edx
  bool v9; // zf
  char v10; // bl
  char v11; // dl
  char *i; // esi

  v3 = a2;
  v4 = a1;
  if ( !a2 )
    return a1;
  if ( a3 )
  {
    while ( 1 )
    {
      v5 = *v3;
      result = v4;
      if ( !*v3 || (unsigned int)(v4 + 1) > a3 )
        break;
      v7 = 0;
      if ( v5 )
      {
        while ( v5 != 46 )
        {
          if ( (unsigned int)&v4[v7 + 2] > a3 )
            goto LABEL_14;
          v4[v7 + 1] = v5;
          v5 = v3[++v7];
          if ( !v5 )
            break;
        }
      }
      *v4 = v7;
      v8 = &v3[v7];
      v4 += v7 + 1;
      v9 = v3[v7] == 0;
      v3 += v7 + 1;
      if ( v9 )
        v3 = v8;
      if ( !v3 )
      {
LABEL_14:
        result += v7 + 1;
        return result;
      }
    }
  }
  else
  {
    while ( 1 )
    {
      v10 = *v3;
      if ( !*v3 )
        break;
      result = v4 + 1;
      v11 = 0;
      for ( i = v3 + 1; v10; v10 = *i++ )
      {
        if ( v10 == 46 )
          break;
        *result++ = v10;
        ++v11;
      }
      *v4 = v11;
      v3 = i - 1;
      v4 = result;
      if ( *(i - 1) )
        v3 = i;
      if ( !v3 )
        return result;
    }
    result = v4;
  }
  return result;
}
